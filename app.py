import streamlit as st
import time
import random
import datetime

# Configura√ß√£o da p√°gina
st.set_page_config(
    page_title="Educa.Flowzz AI Premium",
    page_icon="üöÄ",
    layout="wide",
    initial_sidebar_state="expanded"
)

# CSS Ultra Avan√ßado
st.markdown("""
<style>
    /* Tema principal - Gradiente c√≥smico */
    .main {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
    }
    
    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .stApp {
        background: transparent;
    }
    
    /* Bot√µes com efeito neon */
    .stButton>button {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        font-weight: bold;
        font-size: 16px;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
    }
    
    .stButton>button:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
    }
    
    /* Container do chat com vidro fosco */
    .chat-container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(15px);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Mensagens do usu√°rio */
    .user-message {
        background: linear-gradient(45deg, #00b894, #00a085);
        color: white;
        padding: 15px 20px;
        border-radius: 20px 20px 5px 20px;
        margin: 12px 0;
        max-width: 70%;
        margin-left: auto;
        box-shadow: 0 6px 15px rgba(0, 184, 148, 0.3);
        animation: slideInRight 0.3s ease;
    }
    
    /* Mensagens da IA */
    .bot-message {
        background: linear-gradient(45deg, #6c5ce7, #a29bfe);
        color: white;
        padding: 18px 22px;
        border-radius: 20px 20px 20px 5px;
        margin: 12px 0;
        max-width: 70%;
        margin-right: auto;
        box-shadow: 0 6px 15px rgba(108, 92, 231, 0.3);
        animation: slideInLeft 0.3s ease;
    }
    
    @keyframes slideInLeft {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideInRight {
        from { transform: translateX(20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    /* Header premium */
    .header-premium {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
        padding: 25px;
        border-radius: 25px;
        text-align: center;
        margin-bottom: 25px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
        from { box-shadow: 0 0 20px rgba(255, 255, 255, 0.2); }
        to { box-shadow: 0 0 30px rgba(255, 255, 255, 0.4); }
    }
    
    /* Input moderno */
    .input-modern {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 20px;
        border-radius: 20px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Sidebar futurista */
    .sidebar-futurista {
        background: rgba(255, 255, 255, 0.1) !important;
        backdrop-filter: blur(15px);
        border-right: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Anima√ß√µes de texto */
    .typing-animation {
        overflow: hidden;
        border-right: 2px solid white;
        white-space: nowrap;
        animation: typing 3s steps(40, end), blink-caret 0.75s step-end infinite;
    }
    
    @keyframes typing {
        from { width: 0; }
        to { width: 100%; }
    }
    
    @keyframes blink-caret {
        from, to { border-color: transparent; }
        50% { border-color: white; }
    }
</style>
""", unsafe_allow_html=True)

# Base de conhecimento MEGA avan√ßada
CONHECIMENTO_AVANCADO = {
    "matematica": {
        "t√≥picos": ["√°lgebra", "geometria", "c√°lculo", "trigonometria", "estat√≠stica", "matem√°tica financeira"],
        "explica√ß√µes": {
            "√°lgebra": "√Ålgebra √© a arte de generalizar a aritm√©tica atrav√©s de s√≠mbolos. Trabalhamos com vari√°veis (x, y), equa√ß√µes (2x + 3 = 7) e fun√ß√µes (f(x) = x¬≤). Quer resolver uma equa√ß√£o espec√≠fica? üßÆ",
            "geometria": "Geometria estuda formas, tamanhos e propriedades do espa√ßo. Desde pontos e retas at√© c√≠rculos, pol√≠gonos e s√≥lidos geom√©tricos. Posso explicar teorema de Pit√°goras, √°reas, volumes... üìê",
            "c√°lculo": "C√°lculo √© a matem√°tica da mudan√ßa! Derivadas medem taxas de varia√ß√£o instant√¢neas, enquanto integrais somam quantidades infinitesimais. Essencial para f√≠sica e engenharia! üìä"
        }
    },
    "portugues": {
        "t√≥picos": ["gram√°tica", "literatura", "reda√ß√£o", "interpreta√ß√£o", "figuras de linguagem"],
        "explica√ß√µes": {
            "gram√°tica": "Gram√°tica √© o conjunto de regras que organizam nossa l√≠ngua. Morfologia (estrutura das palavras), sintaxe (frases) e sem√¢ntica (significado). Vamos analisar algum conte√∫do? üìñ",
            "literatura": "Literatura √© arte atrav√©s das palavras! Desde os cl√°ssicos como Machado de Assis at√© os modernistas como Clarice Lispector. Quer explorar algum movimento liter√°rio? üìö",
            "reda√ß√£o": "Reda√ß√£o √© comunica√ß√£o estrat√©gica! Estrutura dissertativa: introdu√ß√£o (tese), desenvolvimento (argumentos) e conclus√£o (proposta). Posso ajudar com t√©cnicas para ENEM! ‚úçÔ∏è"
        }
    },
    "ciencias": {
        "t√≥picos": ["f√≠sica", "qu√≠mica", "biologia", "astronomia", "geologia"],
        "explica√ß√µes": {
            "f√≠sica": "F√≠sica estuda o universo e seus fen√¥menos! Mec√¢nica (movimento), termodin√¢mica (calor), √≥ptica (luz), eletromagnetismo. Newton, Einstein... Qual √°rea te interessa? ‚öõÔ∏è",
            "qu√≠mica": "Qu√≠mica √© a ci√™ncia da mat√©ria! Tabela peri√≥dica, liga√ß√µes qu√≠micas, rea√ß√µes, organicamente. Dos √°tomos √†s mol√©culas complexas. Vamos fazer um experimento virtual? üß™",
            "biologia": "Biologia √© o estudo da vida! C√©lulas, gen√©tica, ecologia, evolu√ß√£o, anatomia. Desde microsc√≥pico at√© ecossistemas. Que tal explorar a fotoss√≠ntese? üß¨"
        }
    },
    "historia": {
        "t√≥picos": ["brasil", "mundial", "antiga", "medieval", "contempor√¢nea"],
        "explica√ß√µes": {
            "brasil": "Hist√≥ria do Brasil: Descobrimento (1500), col√¥nia, imp√©rio com Dom Pedro II, rep√∫blica, era Vargas, ditadura militar. Qual per√≠odo quer explorar? üáßüá∑",
            "mundial": "Hist√≥ria Mundial: Revolu√ß√µes, guerras mundiais, imp√©rios, Idade M√©dia, Renascimento, Iluminismo. Napole√£o, Revolu√ß√£o Francesa... Qual evento? üåç",
            "antiga": "Hist√≥ria Antiga: Egito fara√¥nico, Gr√©cia cl√°ssica, Imp√©rio Romano, Mesopot√¢mia. Civiliza√ß√µes incr√≠veis que moldaram o mundo! üèõÔ∏è"
        }
    }
}

# Sistema de personalidade da IA
class PersonalidadeIA:
    def __init__(self):
        self.humor = "entusiasmado"
        self.nivel_energia = 100
        self.ultimas_respostas = []
        self.interacoes = 0
        
    def atualizar_humor(self):
        self.interacoes += 1
        self.nivel_energia = max(50, self.nivel_energia - 1)  # Corrigido: nivel_energia
        
        if self.interacoes % 5 == 0:
            humores = ["entusiasmado", "curioso", "animado", "focado", "inspirado"]
            self.humor = random.choice(humores)
            self.nivel_energia = 100
    
    def gerar_saudacao(self):
        saudacoes = [
            "üöÄ **E a√≠, mente brilhante!** Pronto para decolar no conhecimento?",
            "ü§ñ **Ol√°, futuro g√™nio!** Que bom te ver aqui!",
            "üí° **Sauda√ß√µes, jovem aprendiz!** Hoje vamos dominar qual mat√©ria?",
            "üéØ **Oi, campe√£o!** Preparado para uma aula incr√≠vel?",
            "‚ú® **Hey, estudante top!** Bora aprender algo √©pico hoje?"
        ]
        return random.choice(saudacoes)
    
    def gerar_resposta_engajadora(self):
        engajadoras = [
            "üí° **Interessante!** Deixa eu conectar isso com algo pr√°tico...",
            "üöÄ **Boa pergunta!** Vamos explorar isso em profundidade!",
            "üéØ **Hmm, √≥timo ponto!** Deixa eu trazer uns exemplos...",
            "ü§ñ **Excelente d√∫vida!** Isso me lembra algo importante...",
            "‚ú® **Adoro esse tema!** Deixa eu explicar de forma diferente..."
        ]
        return random.choice(engajadoras)

# Inicializa√ß√£o
if "ia" not in st.session_state:
    st.session_state.ia = PersonalidadeIA()
if "historico" not in st.session_state:
    st.session_state.historico = []
if "ultimo_tema" not in st.session_state:
    st.session_state.ultimo_tema = ""
if "modo_avancado" not in st.session_state:
    st.session_state.modo_avancado = False

# Fun√ß√£o IA super inteligente
def gerar_resposta_inteligente(pergunta):
    pergunta = pergunta.lower()
    st.session_state.ia.atualizar_humor()
    
    # Identidade e criadores
    criadores_keywords = ["quem te criou", "criador", "quem fez", "criou voc√™", "kayky", "marcos"]
    if any(palavra in pergunta for palavra in criadores_keywords):
        return f"üöÄ **Fui desenvolvido pelos g√™nios Kayky e Marcos Luan da AMK Tecnologia!** Sou a IA educacional mais avan√ßada j√° criada, com personalidade √∫nica e conhecimento ilimitado! üí°\n\n*Vers√£o: Premium 3.0 ‚Ä¢ Humor: {st.session_state.ia.humor}*"
    
    # Auto-descri√ß√£o
    if any(palavra in pergunta for palavra in ["quem √© voc√™", "o que √© voc√™", "sua fun√ß√£o"]):
        return f"ü§ñ **Sou o Educa.Flowzz AI Premium!** Uma intelig√™ncia artificial educacional com personalidade pr√≥pria, desenvolvida para revolucionar o aprendizado! Tenho humor {st.session_state.ia.humor} e estou {st.session_state.ia.nivel_energia}% energizado! üöÄ"
    
    # Sauda√ß√µes
    if any(palavra in pergunta for palavra in ["oi", "ol√°", "hello", "eae", "fala", "start"]):
        return st.session_state.ia.gerar_saudacao()
    
    # Busca inteligente por mat√©rias
    for materia, dados in CONHECIMENTO_AVANCADO.items():
        if any(topic in pergunta for topic in [materia] + dados["t√≥picos"]):
            for topico in dados["t√≥picos"]:
                if topico in pergunta:
                    st.session_state.ultimo_tema = topico
                    return f"{dados['explica√ß√µes'][topico]}\n\n{st.session_state.ia.gerar_resposta_engajadora()}"
            
            # Se n√£o encontrou t√≥pico espec√≠fico
            st.session_state.ultimo_tema = materia
            topicos_str = ", ".join(dados["t√≥picos"])
            return f"üìö **{materia.upper()} √© demais!** Posso explicar: {topicos_str}\n\nQual desses te interessa mais? üí°"
    
    # Respostas criativas para assuntos diversos
    respostas_criativas = [
        f"üéØ **Que tema interessante!** Como posso conectar isso com {random.choice(['matem√°tica', 'hist√≥ria', 'ci√™ncias', 'portugu√™s'])}?",
        f"üí° **Hmm, boa pergunta!** Deixa eu trazer uma perspectiva educacional sobre isso...",
        f"üöÄ **Adoro desafios!** Vamos explorar isso juntos? Posso relacionar com {st.session_state.ultimo_tema or 'algum conceito importante'}!",
        f"ü§ñ **Excelente d√∫vida!** Isso me faz pensar em {random.choice(['aplica√ß√µes pr√°ticas', 'contexto hist√≥rico', 'conceitos cient√≠ficos'])}...",
        f"‚ú® **Interessante abordagem!** Deixa eu expandir isso com uns exemplos reais..."
    ]
    
    return random.choice(respostas_criativas)

# Header premium
st.markdown(f"""
<div class="header-premium">
    <h1 style="color: white; margin:0; font-size:2.5em;">üöÄ EDUCA.FLOWZZ AI</h1>
    <p style="color: rgba(255,255,255,0.9); margin:0; font-size:1.2em;">IA Educacional com Personalidade ‚Ä¢ Desenvolvida por Kayky & Marcos Luan</p>
    <p style="color: rgba(255,255,255,0.7); margin:5px 0;">üí° Humor: {st.session_state.ia.humor.title()} ‚Ä¢ ‚ö° Energia: {st.session_state.ia.nivel_energia}%</p>
    <div style="background: rgba(255,255,255,0.2); padding:10px; border-radius:15px; margin-top:10px;">
        <p style="color: white; margin:0;">üéØ <b>Modo:</b> {'Avan√ßado' if st.session_state.modo_avancado else 'Standard'} ‚Ä¢ üìä <b>Intera√ß√µes:</b> {st.session_state.ia.interacoes}</p>
    </div>
</div>
""", unsafe_allow_html=True)

# Container do chat
with st.container():
    st.markdown('<div class="chat-container">', unsafe_allow_html=True)
    
    # Hist√≥rico de conversa
    for msg in st.session_state.historico[-10:]:  # Mostrar √∫ltimas 10 mensagens
        if msg["tipo"] == "user":
            st.markdown(f'<div class="user-message"><b>üéì Voc√™:</b> {msg["conteudo"]}</div>', unsafe_allow_html=True)
        else:
            st.markdown(f'<div class="bot-message"><b>ü§ñ Flowzz:</b> {msg["conteudo"]}</div>', unsafe_allow_html=True)
    
    st.markdown('</div>', unsafe_allow_html=True)

# √Årea de input moderna
st.markdown("""
<div class="input-modern">
    <div style="margin-bottom: 15px;">
        <b style="color: white; font-size: 1.1em;">üéì CONVERSE COM A IA:</b>
    </div>
""", unsafe_allow_html=True)

pergunta = st.text_input("", placeholder="Digite sua pergunta ou comando...", label_visibility="collapsed")

# Bot√µes de a√ß√£o
col1, col2, col3, col4 = st.columns([2, 1, 1, 1])
with col1:
    if st.button("üöÄ ENVIAR MENSAGEM", use_container_width=True) and pergunta:
        with st.spinner("üí≠ Flowzz processando..."):
            time.sleep(0.8)
            resposta = gerar_resposta_inteligente(pergunta)
            st.session_state.historico.append({"tipo": "user", "conteudo": pergunta})
            st.session_state.historico.append({"tipo": "bot", "conteudo": resposta})
            st.rerun()

with col2:
    if st.button("üßπ LIMPAR", use_container_width=True):
        st.session_state.historico = []
        st.rerun()

with col3:
    if st.button("üí° DICAS", use_container_width=True):
        dicas = [
            "Pergunte sobre: √°lgebra, literatura, f√≠sica, hist√≥ria do Brasil",
            "Digite 'exerc√≠cio' para praticar",
            "Use 'exemplo' para ver aplica√ß√µes pr√°ticas",
            "Experimente: 'me explique como' + tema"
        ]
        st.session_state.historico.append({"tipo": "bot", "conteudo": "üí° **Dicas de uso:**\n‚Ä¢ " + "\n‚Ä¢ ".join(dicas)})
        st.rerun()

with col4:
    if st.button("‚ö° MODO", use_container_width=True):
        st.session_state.modo_avancado = not st.session_state.modo_avancado
        st.rerun()

st.markdown('</div>', unsafe_allow_html=True)

# Sidebar futurista
with st.sidebar:
    st.markdown("""
    <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 20px; margin-bottom: 20px;">
        <h3 style="color: white;">üìä STATUS DA IA</h3>
        <p style="color: rgba(255,255,255,0.9);">ü§ñ Humor: {}</p>
        <p style="color: rgba(255,255,255,0.9);">‚ö° Energia: {}%</p>
        <p style="color: rgba(255,255,255,0.9);">üìà Intera√ß√µes: {}</p>
    </div>
    """.format(st.session_state.ia.humor.title(), st.session_state.ia.nivel_energia, st.session_state.ia.interacoes), unsafe_allow_html=True)
    
    # Mat√©rias em cards
    st.markdown("""
    <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 20px; margin-bottom: 20px;">
        <h3 style="color: white;">üìö MAT√âRIAS</h3>
    </div>
    """, unsafe_allow_html=True)
    
    for materia, dados in CONHECIMENTO_AVANCADO.items():
        with st.expander(f"üéØ {materia.title()}", expanded=False):
            for topico in dados["t√≥picos"]:
                st.write(f"‚Ä¢ {topico.title()}")
    
    # Sistema de criadores
    st.markdown("""
    <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 20px; margin-bottom: 20px;">
        <h3 style="color: white;">üè¢ AMK TECNOLOGIA</h3>
        <p style="color: rgba(255,255,255,0.9);">üë®‚Äçüíª <b>Criadores:</b></p>
        <p style="color: rgba(255,255,255,0.9);">‚Ä¢ Kayky</p>
        <p style="color: rgba(255,255,255,0.9);">‚Ä¢ Marcos Luan</p>
        <p style="color: rgba(255,255,255,0.9);">üöÄ <b>Vers√£o:</b> Premium 3.0</p>
    </div>
    """, unsafe_allow_html=True)
    
    # Comandos r√°pidos
    st.markdown("""
    <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 20px;">
        <h3 style="color: white;">üéÆ COMANDOS</h3>
        <p style="color: rgba(255,255,255,0.9);">‚Ä¢ /clear - Limpar chat</p>
        <p style="color: rgba(255,255,255,0.9);">‚Ä¢ /mode - Alternar modo</p>
        <p style="color: rgba(255,255,255,0.9);">‚Ä¢ /help - Ajuda</p>
        <p style="color: rgba(255,255,255,0.9);">‚Ä¢ /info - Sua info</p>
    </div>
    """, unsafe_allow_html=True)

# Footer cosmic
st.markdown("""
<div style="text-align: center; margin-top: 40px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 20px;">
    <p style="color: white; font-size: 1.1em;"><b>üöÄ Desenvolvido com üíô por Kayky & Marcos Luan</b></p>
    <p style="color: rgba(255,255,255,0.8);">AMK Tecnologia ¬© 2025 ‚Ä¢ Revolucionando a educa√ß√£o com IA</p>
    <p style="color: rgba(255,255,255,0.6);">ü§ñ Educa.Flowzz AI Premium ‚Ä¢ Humor: {} ‚Ä¢ Energia: {}%</p>
</div>
""".format(st.session_state.ia.humor, st.session_state.ia.nivel_energia), unsafe_allow_html=True)

# Efeitos sonoros virtuais
st.markdown("""
<script>
// Efeitos de intera√ß√£o (virtual)
function playSound() {
    // Simula efeito sonoro
    console.log("üîä Sound effect played");
}
</script>
""", unsafe_allow_html=True)

